<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="PaymentAsyncNoticeBizFlow" name="PaymentAsyncNoticeBizFlow">
    <documentation>Place documentation for the 'PaymentAsyncNoticeBizFlow' process here.</documentation>
    <startEvent id="startevent1" name="Start"></startEvent>
    <serviceTask id="sid-C862F2DD-6C59-4544-BA2A-7FB7A09076BA" name="根据订单号获得正常状态的未支付订单" activiti:expression="#{orderService.getByOrderNo(orderNo)}" activiti:resultVariableName="order"></serviceTask>
    <sequenceFlow id="flow1" name="" sourceRef="startevent1" targetRef="sid-C862F2DD-6C59-4544-BA2A-7FB7A09076BA"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow2" name="" sourceRef="sid-C862F2DD-6C59-4544-BA2A-7FB7A09076BA" targetRef="exclusivegateway1"></sequenceFlow>
    <serviceTask id="sid-072F4770-DEFA-4BB2-A758-8DB88CFED49C" name="根据订单业务 id 获得住院流水号" activiti:expression="#{order.businessId}" activiti:resultVariableName="inpatientSN"></serviceTask>
    <sequenceFlow id="sid-7EEB4DE3-1B85-4342-962C-2B7ACEBCA2CC" name="住院押金订单" sourceRef="exclusivegateway1" targetRef="sid-072F4770-DEFA-4BB2-A758-8DB88CFED49C">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{order.itemType.code == 'deposit' && order.status.code == 'normal' && order.payStatus.code == '1'}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="sid-C3D8D886-1D5E-4F35-93A4-785DBFF072BA" name="根据住院流水号获得住院患者信息" activiti:expression="#{inpatientService.getByInpatientSN(inpatientSN)}" activiti:resultVariableName="inpatient"></serviceTask>
    <sequenceFlow id="flow3" name="" sourceRef="sid-072F4770-DEFA-4BB2-A758-8DB88CFED49C" targetRef="sid-C3D8D886-1D5E-4F35-93A4-785DBFF072BA"></sequenceFlow>
    <scriptTask id="sid-CA90B46F-7726-4F9C-AE56-4DB3DABA0071" name="组装外部接口所需参数" scriptFormat="groovy">
      <script><![CDATA[def req = [:]
req['inpatientSN'] = inpatientSN
req['idCard'] = inpatient.idCard
req['payTotalFee'] = order.amount
req['orderId'] = orderNo
req['payTime'] = payTime
req['payChannelId'] = payChannel.code
req['payChannelSN'] = payChannelSN
execution.setVariable('req', req);]]></script>
    </scriptTask>
    <sequenceFlow id="flow4" name="" sourceRef="sid-C3D8D886-1D5E-4F35-93A4-785DBFF072BA" targetRef="sid-CA90B46F-7726-4F9C-AE56-4DB3DABA0071"></sequenceFlow>
    <serviceTask id="sid-627D7AEB-82FC-48BB-957D-204C801FEAC4" name="调用外部接口，通知医院记录支付信息" activiti:expression="#{inpatientFeeExtService.payDeposit(req)}" activiti:resultVariableName="payRes"></serviceTask>
    <sequenceFlow id="flow5" name="" sourceRef="sid-CA90B46F-7726-4F9C-AE56-4DB3DABA0071" targetRef="sid-627D7AEB-82FC-48BB-957D-204C801FEAC4"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway2" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow6" name="" sourceRef="sid-627D7AEB-82FC-48BB-957D-204C801FEAC4" targetRef="exclusivegateway2"></sequenceFlow>
    <scriptTask id="sid-F9266040-A781-46BA-BBC0-BF7206083195" name="更新订单信息" scriptFormat="groovy">
      <script><![CDATA[import com.proper.enterprise.platform.sys.datadic.DataDicLiteBean

order.setStatus(new DataDicLiteBean('ORDER_STATUS', 'closed'))
order.setStatusChangeDate(new java.util.Date())
order.setStatusChangeDesc("Changed by process instance #${execution.getProcessInstanceId()}")
order.setPayChannel(payChannel)
order.setPayChannelSN(payChannelSN)
order.setPayStatus(new DataDicLiteBean('PAY_STATUS', '2'))

execution.setVariable('order', order)]]></script>
    </scriptTask>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="sid-364A7425-1FD7-4239-937C-4F6B23DF810B" name="接口调用失败" sourceRef="exclusivegateway2" targetRef="endevent1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{payRes == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="sid-6B6FD873-FC7C-4FC3-A2A1-27344B9161B8" name="接口调用成功" sourceRef="exclusivegateway2" targetRef="sid-F9266040-A781-46BA-BBC0-BF7206083195">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{payRes == true}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="sid-24568636-9114-409C-A572-43A92AA2023A" name="保存更新后的订单" activiti:expression="#{orderService.save(order)}" activiti:resultVariableName="order"></serviceTask>
    <sequenceFlow id="flow7" name="" sourceRef="sid-F9266040-A781-46BA-BBC0-BF7206083195" targetRef="sid-24568636-9114-409C-A572-43A92AA2023A"></sequenceFlow>
    <serviceTask id="sid-2F9D062D-63D7-46B6-8EB9-5252D186D04E" name="创建押金支付记录" activiti:expression="#{inpatientFeeService.createDepositRecordByOrder(order)}" activiti:resultVariableName="record"></serviceTask>
    <sequenceFlow id="flow8" name="" sourceRef="sid-24568636-9114-409C-A572-43A92AA2023A" targetRef="sid-2F9D062D-63D7-46B6-8EB9-5252D186D04E"></sequenceFlow>
    <sequenceFlow id="flow9" name="" sourceRef="sid-2F9D062D-63D7-46B6-8EB9-5252D186D04E" targetRef="endevent1"></sequenceFlow>
    <serviceTask id="servicetask1" name="通过订单业务 id 获取挂号单信息" activiti:expression="#{registrationService.getRegDocById(order.businessId)}" activiti:resultVariableName="registration"></serviceTask>
    <sequenceFlow id="flow10" name="挂号单" sourceRef="exclusivegateway1" targetRef="servicetask1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{order.itemType.code == 'register' && order.status.code == 'normal' && order.payStatus.code == '1'}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway3" name="Exclusive Gateway"></exclusiveGateway>
    <scriptTask id="scripttask1" name="组装外部接口所需参数" scriptFormat="groovy">
      <script><![CDATA[def req = [:]
req['orderId'] = orderNo
req['hosId'] = registration.rootDeptId
req['serialNum'] = payChannelSN
req['payDate'] = payTime.split(' ')[0]
req['payTime'] = payTime.split(' ')[1]
req['payChannelId'] = payChannel.code
req['payResCode'] = 'SUCCESS'
req['merchantId'] = ''
req['terminalId'] = ''
req['payAccount'] = ''
req['bankNo'] = ''
req['payResDesc'] = ''
req['payTotalFee'] = order.amount
req['payCopeFee'] = order.amount
req['payFee'] = order.amount
if(registration.rootDeptId == '1207') {
  req['operatorId'] = '900008'
} else if(registration.rootDeptId == '1221') {
  req['operatorId'] = '900009'
} else if(registration.rootDeptId == '1222') {
  req['operatorId'] = '900013'
} else {
  req['operatorId'] = ''
}
registration.setRegistrationReq(req)
execution.setVariable('req', req);]]></script>
    </scriptTask>
    <sequenceFlow id="flow15" name="" sourceRef="servicetask1" targetRef="exclusivegateway3"></sequenceFlow>
    <sequenceFlow id="flow16" name="预约挂号" sourceRef="exclusivegateway3" targetRef="scripttask1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{registration.isAppointment == true}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask3" name="调用预约挂号接口，通知医院支付信息" activiti:expression="#{registrationExtService.getPayRegRes(req)}" activiti:resultVariableName="payRegRes"></serviceTask>
    <serviceTask id="servicetask4" name="保存挂号请求业务数据" activiti:expression="#{registrationService.saveRegDoc(req)}" activiti:resultVariableName="registration"></serviceTask>
    <sequenceFlow id="flow19" name="" sourceRef="scripttask1" targetRef="servicetask4"></sequenceFlow>
    <sequenceFlow id="flow20" name="" sourceRef="servicetask4" targetRef="servicetask3"></sequenceFlow>
    <serviceTask id="servicetask5" name="更新订单以及挂号业务表信息" activiti:expression="#{registrationService.updateRegistrationAndOrderStatus(registration, payRegRes, order)}" activiti:resultVariableName="regRes"></serviceTask>
    <sequenceFlow id="flow21" name="" sourceRef="servicetask3" targetRef="servicetask5"></sequenceFlow>
    <serviceTask id="servicetask6" name="发送短信" activiti:expression="#{registrationService.sendRegMessage(regRes.registration)}" activiti:resultVariableName="regRes"></serviceTask>
    <serviceTask id="servicetask7" name="清除30分钟倒计时的挂号单" activiti:expression="#{registrationService.removeRegCache(regRes.registration.id)}" activiti:resultVariableName="regRes"></serviceTask>
    <exclusiveGateway id="exclusivegateway4" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow22" name="" sourceRef="servicetask5" targetRef="exclusivegateway4"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway5" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow24" name="" sourceRef="servicetask6" targetRef="exclusivegateway5"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway6" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow26" name="" sourceRef="servicetask7" targetRef="exclusivegateway6"></sequenceFlow>
    <parallelGateway id="parallelgateway1" name="Parallel Gateway"></parallelGateway>
    <sequenceFlow id="flow27" name="处理失败" sourceRef="exclusivegateway4" targetRef="parallelgateway1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow28" name="处理失败" sourceRef="exclusivegateway5" targetRef="parallelgateway1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow29" name="处理失败" sourceRef="exclusivegateway6" targetRef="parallelgateway1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow30" name="处理成功" sourceRef="exclusivegateway4" targetRef="servicetask6">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow31" name="处理成功" sourceRef="exclusivegateway5" targetRef="servicetask7">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == true}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask9" name="清除医生号点信息缓存" activiti:expression="#{registrationService.removeRegDoctorCache(regRes.registration)}" activiti:resultVariableName="regRes"></serviceTask>
    <sequenceFlow id="flow34" name="" sourceRef="parallelgateway1" targetRef="servicetask9"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway7" name="Exclusive Gateway"></exclusiveGateway>
    <serviceTask id="servicetask10" name="退号" activiti:expression="#{registrationService.saveRegErrCancel(regRes.registration)}" activiti:resultVariableName="res"></serviceTask>
    <serviceTask id="servicetask11" name="退款" activiti:expression="#{registrationService.saveRegErrRefundMoney(regRes.registration)}" activiti:resultVariableName="res"></serviceTask>
    <sequenceFlow id="flow36" name="未占号点" sourceRef="exclusivegateway7" targetRef="servicetask11">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow37" name="成功占号点" sourceRef="exclusivegateway7" targetRef="servicetask10">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow38" name="" sourceRef="servicetask11" targetRef="endevent1"></sequenceFlow>
    <sequenceFlow id="flow39" name="" sourceRef="servicetask10" targetRef="endevent1"></sequenceFlow>
    <scriptTask id="scripttask2" name="组装外部接口所需参数" scriptFormat="groovy">
      <script><![CDATA[def req = [:]
req['lockId'] = '1'
req['orderId'] = orderNo
req['hospPatientId'] = ''
req['channelId'] = '3'
req['isAppointment'] = '1'
req['regId'] = registration.regId
req['regLevel'] = registration.regLevel
req['hosId'] = registration.rootDeptId
req['deptId'] = registration.deptId
req['doctorId'] = registration.doctorId
registration.setRegistrationReq(req)
execution.setVariable('req', req);]]></script>
    </scriptTask>
    <sequenceFlow id="flow40" name="当日挂号" sourceRef="exclusivegateway3" targetRef="scripttask2">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{registration.isAppointment == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask12" name="保存挂号请求业务数据" activiti:expression="#{registrationService.saveRegDoc(req)}" activiti:resultVariableName="registration"></serviceTask>
    <sequenceFlow id="flow41" name="" sourceRef="scripttask2" targetRef="servicetask12"></sequenceFlow>
    <serviceTask id="servicetask13" name="调用当日挂号接口，通知医院支付信息" activiti:expression="#{registrationExtService.getPayOrderRegRes(req)}" activiti:resultVariableName="payRegRes"></serviceTask>
    <sequenceFlow id="flow42" name="" sourceRef="servicetask12" targetRef="servicetask13"></sequenceFlow>
    <serviceTask id="servicetask14" name="更新订单以及挂号业务表信息" activiti:expression="#{registrationService.updateRegistrationAndOrderStatus(registration, payRegRes, order)}" activiti:resultVariableName="regRes"></serviceTask>
    <sequenceFlow id="flow43" name="" sourceRef="servicetask13" targetRef="servicetask14"></sequenceFlow>
    <serviceTask id="servicetask15" name="发送短信" activiti:expression="#{registrationService.sendRegMessage(reg.registration)}" activiti:resultVariableName="regRes"></serviceTask>
    <exclusiveGateway id="exclusivegateway8" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow45" name="" sourceRef="servicetask14" targetRef="exclusivegateway8"></sequenceFlow>
    <sequenceFlow id="flow46" name="处理成功" sourceRef="exclusivegateway8" targetRef="servicetask15">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes == true}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway9" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow47" name="" sourceRef="servicetask15" targetRef="exclusivegateway9"></sequenceFlow>
    <parallelGateway id="parallelgateway2" name="Parallel Gateway"></parallelGateway>
    <sequenceFlow id="flow49" name="处理失败" sourceRef="exclusivegateway8" targetRef="parallelgateway2">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow50" name="处理失败" sourceRef="exclusivegateway9" targetRef="parallelgateway2">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{reg.res == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow51" name="处理成功" sourceRef="exclusivegateway9" targetRef="endevent1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{reg.res == true}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask16" name="当日挂号退号" activiti:expression="#{registrationService.saveRegTodayErrCancel(reg.registration)}" activiti:resultVariableName="res"></serviceTask>
    <sequenceFlow id="flow52" name="" sourceRef="parallelgateway2" targetRef="servicetask16"></sequenceFlow>
    <sequenceFlow id="flow53" name="" sourceRef="servicetask16" targetRef="endevent1"></sequenceFlow>
    <serviceTask id="servicetask17" name="清除医生号点缓存" activiti:expression="#{registrationService.removeRegDoctorCache(regRes.registration)}" activiti:resultVariableName="regRes"></serviceTask>
    <sequenceFlow id="flow54" name="处理成功" sourceRef="exclusivegateway6" targetRef="servicetask17">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == true}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway10" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow55" name="" sourceRef="servicetask17" targetRef="exclusivegateway10"></sequenceFlow>
    <sequenceFlow id="flow56" name="处理失败" sourceRef="exclusivegateway10" targetRef="parallelgateway1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == false}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow57" name="处理成功" sourceRef="exclusivegateway10" targetRef="endevent1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[#{regRes.res == true}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask18" name="判断是否占用号点" activiti:expression="#{registrationService.isRegSuccess(regRes.registration)}" activiti:resultVariableName="regRes"></serviceTask>
    <sequenceFlow id="flow58" name="" sourceRef="servicetask9" targetRef="servicetask18"></sequenceFlow>
    <sequenceFlow id="flow59" name="" sourceRef="servicetask18" targetRef="exclusivegateway7"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_PaymentAsyncNoticeBizFlow">
    <bpmndi:BPMNPlane bpmnElement="PaymentAsyncNoticeBizFlow" id="BPMNPlane_PaymentAsyncNoticeBizFlow">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35" width="35" x="755" y="11"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-C862F2DD-6C59-4544-BA2A-7FB7A09076BA" id="BPMNShape_sid-C862F2DD-6C59-4544-BA2A-7FB7A09076BA">
        <omgdc:Bounds height="55" width="126" x="710" y="76"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40" width="40" x="752" y="166"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-072F4770-DEFA-4BB2-A758-8DB88CFED49C" id="BPMNShape_sid-072F4770-DEFA-4BB2-A758-8DB88CFED49C">
        <omgdc:Bounds height="55" width="105" x="1257" y="225"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-C3D8D886-1D5E-4F35-93A4-785DBFF072BA" id="BPMNShape_sid-C3D8D886-1D5E-4F35-93A4-785DBFF072BA">
        <omgdc:Bounds height="55" width="105" x="1257" y="315"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-CA90B46F-7726-4F9C-AE56-4DB3DABA0071" id="BPMNShape_sid-CA90B46F-7726-4F9C-AE56-4DB3DABA0071">
        <omgdc:Bounds height="55" width="105" x="1257" y="405"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-627D7AEB-82FC-48BB-957D-204C801FEAC4" id="BPMNShape_sid-627D7AEB-82FC-48BB-957D-204C801FEAC4">
        <omgdc:Bounds height="55" width="131" x="1244" y="495"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway2" id="BPMNShape_exclusivegateway2">
        <omgdc:Bounds height="40" width="40" x="1407" y="502"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-F9266040-A781-46BA-BBC0-BF7206083195" id="BPMNShape_sid-F9266040-A781-46BA-BBC0-BF7206083195">
        <omgdc:Bounds height="55" width="105" x="1455" y="605"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35" width="35" x="755" y="1120"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-24568636-9114-409C-A572-43A92AA2023A" id="BPMNShape_sid-24568636-9114-409C-A572-43A92AA2023A">
        <omgdc:Bounds height="55" width="105" x="1455" y="725"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-2F9D062D-63D7-46B6-8EB9-5252D186D04E" id="BPMNShape_sid-2F9D062D-63D7-46B6-8EB9-5252D186D04E">
        <omgdc:Bounds height="55" width="105" x="1455" y="875"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask1" id="BPMNShape_servicetask1">
        <omgdc:Bounds height="55" width="126" x="710" y="243"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway3" id="BPMNShape_exclusivegateway3">
        <omgdc:Bounds height="40" width="40" x="752" y="332"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask1" id="BPMNShape_scripttask1">
        <omgdc:Bounds height="55" width="131" x="1087" y="325"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask3" id="BPMNShape_servicetask3">
        <omgdc:Bounds height="55" width="128" x="1090" y="501"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask4" id="BPMNShape_servicetask4">
        <omgdc:Bounds height="55" width="131" x="1087" y="415"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask5" id="BPMNShape_servicetask5">
        <omgdc:Bounds height="55" width="128" x="1090" y="595"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask6" id="BPMNShape_servicetask6">
        <omgdc:Bounds height="55" width="131" x="1087" y="691"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask7" id="BPMNShape_servicetask7">
        <omgdc:Bounds height="55" width="131" x="1087" y="792"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway4" id="BPMNShape_exclusivegateway4">
        <omgdc:Bounds height="40" width="40" x="985" y="602"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway5" id="BPMNShape_exclusivegateway5">
        <omgdc:Bounds height="40" width="40" x="985" y="698"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway6" id="BPMNShape_exclusivegateway6">
        <omgdc:Bounds height="40" width="40" x="985" y="799"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="parallelgateway1" id="BPMNShape_parallelgateway1">
        <omgdc:Bounds height="40" width="40" x="752" y="602"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask9" id="BPMNShape_servicetask9">
        <omgdc:Bounds height="55" width="105" x="720" y="690"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway7" id="BPMNShape_exclusivegateway7">
        <omgdc:Bounds height="40" width="40" x="752" y="846"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask10" id="BPMNShape_servicetask10">
        <omgdc:Bounds height="55" width="105" x="799" y="929"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask11" id="BPMNShape_servicetask11">
        <omgdc:Bounds height="55" width="105" x="639" y="929"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask2" id="BPMNShape_scripttask2">
        <omgdc:Bounds height="55" width="135" x="140" y="325"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask12" id="BPMNShape_servicetask12">
        <omgdc:Bounds height="55" width="135" x="140" y="415"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask13" id="BPMNShape_servicetask13">
        <omgdc:Bounds height="55" width="135" x="140" y="495"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask14" id="BPMNShape_servicetask14">
        <omgdc:Bounds height="55" width="135" x="140" y="595"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask15" id="BPMNShape_servicetask15">
        <omgdc:Bounds height="55" width="135" x="140" y="690"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway8" id="BPMNShape_exclusivegateway8">
        <omgdc:Bounds height="40" width="40" x="340" y="602"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway9" id="BPMNShape_exclusivegateway9">
        <omgdc:Bounds height="40" width="40" x="340" y="697"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="parallelgateway2" id="BPMNShape_parallelgateway2">
        <omgdc:Bounds height="40" width="40" x="500" y="602"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask16" id="BPMNShape_servicetask16">
        <omgdc:Bounds height="55" width="105" x="468" y="839"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask17" id="BPMNShape_servicetask17">
        <omgdc:Bounds height="55" width="128" x="1090" y="875"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway10" id="BPMNShape_exclusivegateway10">
        <omgdc:Bounds height="40" width="40" x="985" y="882"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask18" id="BPMNShape_servicetask18">
        <omgdc:Bounds height="55" width="105" x="718" y="775"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="772" y="46"></omgdi:waypoint>
        <omgdi:waypoint x="773" y="76"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="773" y="131"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="166"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-7EEB4DE3-1B85-4342-962C-2B7ACEBCA2CC" id="BPMNEdge_sid-7EEB4DE3-1B85-4342-962C-2B7ACEBCA2CC">
        <omgdi:waypoint x="792" y="186"></omgdi:waypoint>
        <omgdi:waypoint x="1309" y="185"></omgdi:waypoint>
        <omgdi:waypoint x="1309" y="225"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="1309" y="280"></omgdi:waypoint>
        <omgdi:waypoint x="1309" y="315"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="1309" y="370"></omgdi:waypoint>
        <omgdi:waypoint x="1309" y="405"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
        <omgdi:waypoint x="1309" y="460"></omgdi:waypoint>
        <omgdi:waypoint x="1309" y="495"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
        <omgdi:waypoint x="1375" y="522"></omgdi:waypoint>
        <omgdi:waypoint x="1407" y="522"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-364A7425-1FD7-4239-937C-4F6B23DF810B" id="BPMNEdge_sid-364A7425-1FD7-4239-937C-4F6B23DF810B">
        <omgdi:waypoint x="1427" y="542"></omgdi:waypoint>
        <omgdi:waypoint x="1427" y="901"></omgdi:waypoint>
        <omgdi:waypoint x="1080" y="1034"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="1120"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-6B6FD873-FC7C-4FC3-A2A1-27344B9161B8" id="BPMNEdge_sid-6B6FD873-FC7C-4FC3-A2A1-27344B9161B8">
        <omgdi:waypoint x="1447" y="522"></omgdi:waypoint>
        <omgdi:waypoint x="1507" y="522"></omgdi:waypoint>
        <omgdi:waypoint x="1507" y="605"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
        <omgdi:waypoint x="1507" y="660"></omgdi:waypoint>
        <omgdi:waypoint x="1507" y="725"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8">
        <omgdi:waypoint x="1507" y="780"></omgdi:waypoint>
        <omgdi:waypoint x="1507" y="875"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow9" id="BPMNEdge_flow9">
        <omgdi:waypoint x="1507" y="930"></omgdi:waypoint>
        <omgdi:waypoint x="1507" y="1137"></omgdi:waypoint>
        <omgdi:waypoint x="790" y="1137"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
        <omgdi:waypoint x="772" y="206"></omgdi:waypoint>
        <omgdi:waypoint x="773" y="243"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
        <omgdi:waypoint x="773" y="298"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="332"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow16" id="BPMNEdge_flow16">
        <omgdi:waypoint x="792" y="352"></omgdi:waypoint>
        <omgdi:waypoint x="1087" y="352"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow19" id="BPMNEdge_flow19">
        <omgdi:waypoint x="1152" y="380"></omgdi:waypoint>
        <omgdi:waypoint x="1152" y="415"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow20" id="BPMNEdge_flow20">
        <omgdi:waypoint x="1152" y="470"></omgdi:waypoint>
        <omgdi:waypoint x="1154" y="501"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow21" id="BPMNEdge_flow21">
        <omgdi:waypoint x="1154" y="556"></omgdi:waypoint>
        <omgdi:waypoint x="1154" y="595"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow22" id="BPMNEdge_flow22">
        <omgdi:waypoint x="1090" y="622"></omgdi:waypoint>
        <omgdi:waypoint x="1025" y="622"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow24" id="BPMNEdge_flow24">
        <omgdi:waypoint x="1087" y="718"></omgdi:waypoint>
        <omgdi:waypoint x="1025" y="718"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow26" id="BPMNEdge_flow26">
        <omgdi:waypoint x="1087" y="819"></omgdi:waypoint>
        <omgdi:waypoint x="1025" y="819"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow27" id="BPMNEdge_flow27">
        <omgdi:waypoint x="985" y="622"></omgdi:waypoint>
        <omgdi:waypoint x="792" y="622"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow28" id="BPMNEdge_flow28">
        <omgdi:waypoint x="1005" y="698"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="642"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow29" id="BPMNEdge_flow29">
        <omgdi:waypoint x="1005" y="799"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="642"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow30" id="BPMNEdge_flow30">
        <omgdi:waypoint x="1005" y="642"></omgdi:waypoint>
        <omgdi:waypoint x="1152" y="691"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow31" id="BPMNEdge_flow31">
        <omgdi:waypoint x="1005" y="738"></omgdi:waypoint>
        <omgdi:waypoint x="1152" y="792"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow34" id="BPMNEdge_flow34">
        <omgdi:waypoint x="772" y="642"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="690"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow36" id="BPMNEdge_flow36">
        <omgdi:waypoint x="772" y="886"></omgdi:waypoint>
        <omgdi:waypoint x="691" y="929"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow37" id="BPMNEdge_flow37">
        <omgdi:waypoint x="772" y="886"></omgdi:waypoint>
        <omgdi:waypoint x="851" y="929"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow38" id="BPMNEdge_flow38">
        <omgdi:waypoint x="691" y="984"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="1120"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow39" id="BPMNEdge_flow39">
        <omgdi:waypoint x="851" y="984"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="1120"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow40" id="BPMNEdge_flow40">
        <omgdi:waypoint x="752" y="352"></omgdi:waypoint>
        <omgdi:waypoint x="275" y="352"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow41" id="BPMNEdge_flow41">
        <omgdi:waypoint x="207" y="380"></omgdi:waypoint>
        <omgdi:waypoint x="207" y="415"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow42" id="BPMNEdge_flow42">
        <omgdi:waypoint x="207" y="470"></omgdi:waypoint>
        <omgdi:waypoint x="207" y="495"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow43" id="BPMNEdge_flow43">
        <omgdi:waypoint x="207" y="550"></omgdi:waypoint>
        <omgdi:waypoint x="207" y="595"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow45" id="BPMNEdge_flow45">
        <omgdi:waypoint x="275" y="622"></omgdi:waypoint>
        <omgdi:waypoint x="340" y="622"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow46" id="BPMNEdge_flow46">
        <omgdi:waypoint x="360" y="642"></omgdi:waypoint>
        <omgdi:waypoint x="207" y="690"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow47" id="BPMNEdge_flow47">
        <omgdi:waypoint x="275" y="717"></omgdi:waypoint>
        <omgdi:waypoint x="340" y="717"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow49" id="BPMNEdge_flow49">
        <omgdi:waypoint x="380" y="622"></omgdi:waypoint>
        <omgdi:waypoint x="500" y="622"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow50" id="BPMNEdge_flow50">
        <omgdi:waypoint x="360" y="697"></omgdi:waypoint>
        <omgdi:waypoint x="520" y="642"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow51" id="BPMNEdge_flow51">
        <omgdi:waypoint x="360" y="737"></omgdi:waypoint>
        <omgdi:waypoint x="360" y="1137"></omgdi:waypoint>
        <omgdi:waypoint x="755" y="1137"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow52" id="BPMNEdge_flow52">
        <omgdi:waypoint x="520" y="642"></omgdi:waypoint>
        <omgdi:waypoint x="520" y="839"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow53" id="BPMNEdge_flow53">
        <omgdi:waypoint x="520" y="894"></omgdi:waypoint>
        <omgdi:waypoint x="520" y="968"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="1120"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow54" id="BPMNEdge_flow54">
        <omgdi:waypoint x="1005" y="839"></omgdi:waypoint>
        <omgdi:waypoint x="1154" y="875"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow55" id="BPMNEdge_flow55">
        <omgdi:waypoint x="1090" y="902"></omgdi:waypoint>
        <omgdi:waypoint x="1025" y="902"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow56" id="BPMNEdge_flow56">
        <omgdi:waypoint x="1005" y="882"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="642"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow57" id="BPMNEdge_flow57">
        <omgdi:waypoint x="1005" y="922"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="1120"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow58" id="BPMNEdge_flow58">
        <omgdi:waypoint x="772" y="745"></omgdi:waypoint>
        <omgdi:waypoint x="770" y="775"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow59" id="BPMNEdge_flow59">
        <omgdi:waypoint x="770" y="830"></omgdi:waypoint>
        <omgdi:waypoint x="772" y="846"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>